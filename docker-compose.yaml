version: '3'
services:
  github-proxy:
    container_name: github-proxy
    image: 'sourcegraph/github-proxy:3.5.2'
    environment:
      - GOMAXPROCS=1
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
    networks:
      - sourcegraph
    restart: always
  gitserver-0:
    container_name: gitserver-0
    image: 'sourcegraph/gitserver:3.5.2'
    environment:
      - GOMAXPROCS=4
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/gitserver-0-disk:/data/repos'
    networks:
      - sourcegraph
    restart: always
  grafana:
    container_name: grafana
    image: >-
      grafana/grafana:6.1.1@sha256:e7a513bf7f33ef9681b2d35a799136e1ce9330f9055f75dfa2101d812946184b
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_NAME=Sourcegraph
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Editor
      - GF_USERS_ALLOW_SIGN_UP=false
      - GF_USERS_AUTO_ASSIGN_ORG=true
      - GF_USERS_AUTO_ASSIGN_ORG_ROLE=Editor
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/grafana-disk:/var/lib/grafana'
      - >-
        /Users/ggilmore/dev/go/src/github.com/sourcegraph/ds-docker/grafana:/etc/grafana
    ports:
      - '0.0.0.0:3000:3000'
    networks:
      - sourcegraph
    restart: always
  jaeger-agent:
    container_name: jaeger-agent
    image: >-
      jaegertracing/jaeger-agent@sha256:7ad33c19fd66307f2a3c07c95eb07c335ddce1b487f6b6128faa75d042c496cb
    environment:
      - 'COLLECTOR_HOST_PORT=jaeger-collector:14267'
    networks:
      - sourcegraph
    restart: always
  jaeger-cassandra:
    container_name: jaeger-cassandra
    image: >-
      cassandra:3.11.4@sha256:9f1d47fd23261c49f226546fe0134e6d4ad0570b7ea3a169c521005cb8369a32
    environment:
      - HEAP_NEWSIZE=1G
      - MAX_HEAP_SIZE=6G
      - CASSANDRA_DC=sourcegraph
      - CASSANDRA_RACK=rack1
      - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/jaeger-cassandra-disk/:/var/lib/cassandra
    networks:
      - sourcegraph
    restart: always
  jaeger-collector:
    container_name: jaeger-collector
    image: >-
      jaegertracing/jaeger-collector:1.11@sha256:0b6d28bb52410f7b50c0f0fc16d7ee391e2e3eca47b713ac88d0891ca8a63cb9
    environment:
      - SPAN_STORAGE_TYPE=cassandra
      - CASSANDRA_SERVERS=jaeger-cassandra
      - CASSANDRA_KEYSPACE=jaeger_v1_sourcegraph
    networks:
      - sourcegraph
    restart: always
  jaeger-query:
    container_name: jaeger-query
    image: >-
      jaegertracing/jaeger-query:1.11@sha256:cddc521d0166c868931282685a863368ae2c14c4de0c1be38e388ece3080439e
    environment:
      - SPAN_STORAGE_TYPE=cassandra
      - CASSANDRA_SERVERS=jaeger-cassandra
      - CASSANDRA_KEYSPACE=jaeger_v1_sourcegraph
      - CASSANDRA_LOCAL_DC=sourcegraph
    ports:
      - '0.0.0.0:16686:16686'
    networks:
      - sourcegraph
    restart: always
  jaeger-cassandra-schema:
    container_name: jaeger-cassandra-schema
    image: >-
      jaegertracing/jaeger-cassandra-schema@sha256:ba0ffb1953c76705539360c2f83eafe32b977529c3399d1abeb69c94f29c45d0
    environment:
      - CQLSH_HOST=jaeger-cassandra
      - DATACENTER=sourcegraph
      - KEYSPACE=jaeger_v1_sourcegraph
      - MODE=prod
    networks:
      - sourcegraph
  management-console:
    container_name: management-console
    image: 'sourcegraph/management-console:3.5.2'
    environment:
      - GOMAXPROCS=1
      - PGHOST=pgsql
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/management-console-disk:/etc/sourcegraph
    ports:
      - '0.0.0.0:2633:2633'
    networks:
      - sourcegraph
    restart: always
  pgsql:
    container_name: pgsql
    image: >-
      sourcegraph/postgres-11.1:19-02-13_22d74790@sha256:10c2ff7a4da422cd75e022b51bef3a0c935f4b3ded335d9679a4f1202db605d2
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/pgsql-disk:/data/pgdata'
    networks:
      - sourcegraph
    restart: always
  prometheus:
    container_name: prometheus
    image: >-
      sourcegraph/prometheus:v1.4.1@sha256:1a02878ac9a0f532a68673bda93d406b21786706446c42a40cb3ed3e867278c0
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/prometheus-disk:/prometheus-data'
      - >-
        /Users/ggilmore/dev/go/src/github.com/sourcegraph/ds-docker/prometheus:/etc/prometheus
    ports:
      - '0.0.0.0:9090:9090'
    networks:
      - sourcegraph
    restart: always
    command: >-
      -o -n -f -i -g -. -f -i -l -e -= -/ -e -t -c -/ -p -r -o -m -e -t -h -e -u
      -s -/ -p -r -o -m -e -t -h -e -u -s -. -y -m -l
      -storage.local.path=/prometheus-data -w -e -b -. -c -o -n -s -o -l -e -.
      -l -i -b -r -a -r -i -e -s -= -/ -e -t -c -/ -p -r -o -m -e -t -h -e -u -s
      -/ -c -o -n -s -o -l -e -_ -l -i -b -r -a -r -i -e -s -w -e -b -. -c -o -n
      -s -o -l -e -. -t -e -m -p -l -a -t -e -s -= -/ -e -t -c -/ -p -r -o -m -e
      -t -h -e -u -s -/ -c -o -n -s -o -l -e -s
  query-runner:
    container_name: query-runner
    image: 'sourcegraph/query-runner:3.5.2'
    environment:
      - GOMAXPROCS=1
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
    networks:
      - sourcegraph
    restart: always
  redis-store:
    container_name: redis-store
    image: >-
      sourcegraph/redis-store:18-10-28_e45f6d82@sha256:1fe101e1f04a8e267fda85c342cd3b974ab4a9e47718b864752f14f1da51579c
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/redis-store-disk:/redis-data'
    networks:
      - sourcegraph
    restart: always
  repo-updater:
    container_name: repo-updater
    image: 'sourcegraph/repo-updater:3.5.2'
    environment:
      - GOMAXPROCS=1
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
      - 'GITHUB_BASE_URL=http://github-proxy:3180'
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/repo-updater-disk:/mnt/cache'
    networks:
      - sourcegraph
    restart: always
  redis-cache:
    container_name: redis-cache
    image: >-
      sourcegraph/redis-cache:18-10-28_ba610fdf@sha256:10a4430cb8bb9c0ad2b96eac40882509fb1b11cbd77cffd0900f74a58a4014d2
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/redis-cache-disk:/redis-data'
    networks:
      - sourcegraph
    restart: always
  searcher-0:
    container_name: searcher-0
    image: 'sourcegraph/searcher:3.5.2'
    environment:
      - GOMAXPROCS=2
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/searcher-0-disk:/mnt/cache'
    networks:
      - sourcegraph
    restart: always
  syntect-server:
    container_name: syntect-server
    image: >-
      sourcegraph/syntect_server:5e1efbb@sha256:6ec136246b302a6c8fc113f087a66d5f9a89a9f5b851e9abb917c8b5e1d8c4b1
    networks:
      - sourcegraph
    restart: always
  symbols-0:
    container_name: symbols-0
    image: 'sourcegraph/symbols:3.5.2'
    environment:
      - GOMAXPROCS=2
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - JAEGER_AGENT_HOST=jaeger-agent
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/symbols-0-disk:/mnt/cache'
    networks:
      - sourcegraph
    restart: always
  zoekt-indexserver:
    container_name: zoekt-indexserver
    image: >-
      sourcegraph/zoekt-indexserver:2019.08.19-014a202@sha256:3e3ff3723c96afd479177f51f25d0b4e6081281db3e6329aa3ef0a6db1759d99
    environment:
      - GOMAXPROCS=4
      - 'SRC_FRONTEND_INTERNAL=http://sourcegraph-frontend-internal:3090'
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/zoekt-shared-disk:/data/index'
    networks:
      - sourcegraph
    restart: always
  zoekt-webserver:
    container_name: zoekt-webserver
    image: >-
      sourcegraph/zoekt-webserver:2019.08.19-014a202@sha256:1f1420ed341c3f7bc3041cd46c4bf1eba97b830aeffce9640472daccb2621788
    environment:
      - GOMAXPROCS=8
    volumes:
      - '/Users/ggilmore/sourcegraph-docker/zoekt-shared-disk:/data/index'
    networks:
      - sourcegraph
    restart: always
  sourcegraph-frontend-internal:
    container_name: sourcegraph-frontend-internal
    image: 'sourcegraph/frontend:3.5.2'
    environment:
      - GOMAXPROCS=4
      - PGHOST=pgsql
      - 'SRC_GIT_SERVERS=gitserver-0:3178'
      - 'SRC_SYNTECT_SERVER=http://syntect-server:9238'
      - 'SEARCHER_URL=http://searcher-0:3181'
      - 'SYMBOLS_URL=http://symbols-0:3184'
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - 'REPO_UPDATER_URL=http://repo-updater:3182'
      - 'ZOEKT_HOST=zoekt-webserver:6070'
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/sourcegraph-frontend-internal-0-disk:/mnt/cache
    networks:
      - sourcegraph
    restart: always
  sourcegraph-frontend-0:
    container_name: sourcegraph-frontend-0
    image: 'sourcegraph/frontend:3.5.2'
    environment:
      - GOMAXPROCS=12
      - JAEGER_AGENT_HOST=jaeger-agent
      - PGHOST=pgsql
      - 'SRC_GIT_SERVERS=gitserver-0:3178'
      - 'SRC_SYNTECT_SERVER=http://syntect-server:9238'
      - 'SEARCHER_URL=http://searcher-0:3181'
      - 'SYMBOLS_URL=http://symbols-0:3184'
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - 'REPO_UPDATER_URL=http://repo-updater:3182'
      - 'ZOEKT_HOST=zoekt-webserver:6070'
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/sourcegraph-frontend-0-disk:/mnt/cache
    ports:
      - '0.0.0.0:3080:3080'
    networks:
      - sourcegraph
    restart: always
  sourcegraph-frontend-1:
    container_name: sourcegraph-frontend-1
    image: 'sourcegraph/frontend:3.5.2'
    environment:
      - GOMAXPROCS=12
      - JAEGER_AGENT_HOST=jaeger-agent
      - PGHOST=pgsql
      - 'SRC_GIT_SERVERS=gitserver-0:3178'
      - 'SRC_SYNTECT_SERVER=http://syntect-server:9238'
      - 'SEARCHER_URL=http://searcher-0:3181'
      - 'SYMBOLS_URL=http://symbols-0:3184'
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - 'REPO_UPDATER_URL=http://repo-updater:3182'
      - 'ZOEKT_HOST=zoekt-webserver:6070'
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/sourcegraph-frontend-1-disk:/mnt/cache
    ports:
      - '0.0.0.0:3081:3080'
    networks:
      - sourcegraph
    restart: always
  sourcegraph-frontend-2:
    container_name: sourcegraph-frontend-2
    image: 'sourcegraph/frontend:3.5.2'
    environment:
      - GOMAXPROCS=12
      - JAEGER_AGENT_HOST=jaeger-agent
      - PGHOST=pgsql
      - 'SRC_GIT_SERVERS=gitserver-0:3178'
      - 'SRC_SYNTECT_SERVER=http://syntect-server:9238'
      - 'SEARCHER_URL=http://searcher-0:3181'
      - 'SYMBOLS_URL=http://symbols-0:3184'
      - 'SRC_FRONTEND_INTERNAL=sourcegraph-frontend-internal:3090'
      - 'REPO_UPDATER_URL=http://repo-updater:3182'
      - 'ZOEKT_HOST=zoekt-webserver:6070'
    volumes:
      - >-
        /Users/ggilmore/sourcegraph-docker/sourcegraph-frontend-2-disk:/mnt/cache
    ports:
      - '0.0.0.0:3082:3080'
    networks:
      - sourcegraph
    restart: always
